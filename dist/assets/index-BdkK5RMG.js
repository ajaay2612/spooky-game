(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();class B{constructor(e){this.scene=e,this.selectedObject=null,this.highlightLayer=null,this.onSelectionChanged=null,this.selectionCallbacks=[],this.initialize()}initialize(){this.highlightLayer=new BABYLON.HighlightLayer("highlight",this.scene),this.highlightLayer.outerGlow=!0,this.highlightLayer.innerGlow=!1,console.log("SelectionManager initialized with HighlightLayer")}setupPicking(e){this.scene.onPointerDown=(t,i)=>{t.button===0&&(i.hit&&i.pickedMesh?i.pickedMesh.name.startsWith("_")||this.selectObject(i.pickedMesh):this.deselectObject())},console.log("Mouse picking enabled for object selection")}selectObject(e){if(!e||e.isDisposed()){console.warn("Cannot select invalid or disposed object");return}this.selectedObject&&this.selectedObject instanceof BABYLON.Mesh&&this.highlightLayer.removeMesh(this.selectedObject),this.selectedObject=e,e instanceof BABYLON.Mesh&&this.highlightLayer.addMesh(e,BABYLON.Color3.Yellow()),this.onSelectionChanged&&this.onSelectionChanged(e),this.selectionCallbacks.forEach(t=>t(e)),console.log(`Selected object: ${e.name}`)}deselectObject(){this.selectedObject&&(this.selectedObject instanceof BABYLON.Mesh&&this.highlightLayer.removeMesh(this.selectedObject),console.log(`Deselected object: ${this.selectedObject.name}`),this.selectedObject=null,this.onSelectionChanged&&this.onSelectionChanged(null),this.selectionCallbacks.forEach(e=>e(null)))}addSelectionCallback(e){e&&typeof e=="function"&&this.selectionCallbacks.push(e)}dispose(){this.highlightLayer&&(this.highlightLayer.dispose(),this.highlightLayer=null)}}class L{constructor(e,t){this.scene=e,this.canvas=t,this.editorCamera=null,this.playerCamera=null,this.activeCamera=null}createPlayerCamera(){const e=new BABYLON.UniversalCamera("playerCamera",new BABYLON.Vector3(0,1.6,-5),this.scene);return e.setTarget(new BABYLON.Vector3(0,1.6,0)),e.speed=.1,e.angularSensibility=2e3,e.keysUp=[87],e.keysDown=[83],e.keysLeft=[65],e.keysRight=[68],console.log("Player camera (UniversalCamera) created"),this.playerCamera=e,e}createEditorCamera(){const e=new BABYLON.ArcRotateCamera("editorCamera",Math.PI/2,Math.PI/3,15,new BABYLON.Vector3(0,1.5,0),this.scene);return e.panningSensibility=1e3,e.wheelPrecision=50,e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.lowerRadiusLimit=2,e.upperRadiusLimit=100,e.lowerBetaLimit=.1,e.upperBetaLimit=Math.PI/2,e.inputs.attached.pointers.buttons=[2,1,0],console.log("Editor camera (ArcRotateCamera) created"),this.editorCamera=e,e}switchToEditorCamera(){this.editorCamera||this.createEditorCamera(),document.pointerLockElement===this.canvas&&document.exitPointerLock(),this.playerCamera&&this.playerCamera.detachControl(),this.editorCamera.attachControl(this.canvas,!0),this.scene.activeCamera=this.editorCamera,this.activeCamera=this.editorCamera,console.log("Switched to editor camera")}switchToPlayerCamera(){this.playerCamera||this.createPlayerCamera(),this.editorCamera&&this.editorCamera.detachControl(),this.playerCamera.attachControl(this.canvas,!0),this.scene.activeCamera=this.playerCamera,this.activeCamera=this.playerCamera,this.canvas.requestPointerLock(),console.log("Switched to player camera")}initialize(){this.createPlayerCamera(),this.createEditorCamera(),this.switchToEditorCamera()}}class m{constructor(e){this.scene=e,this.objectCounter=0}createPrimitive(e){const t=`${e}_${this.objectCounter++}`;let i;switch(e.toLowerCase()){case"box":i=BABYLON.MeshBuilder.CreateBox(t,{size:1},this.scene);break;case"sphere":i=BABYLON.MeshBuilder.CreateSphere(t,{diameter:1},this.scene);break;case"cylinder":i=BABYLON.MeshBuilder.CreateCylinder(t,{height:2,diameter:1},this.scene);break;case"cone":i=BABYLON.MeshBuilder.CreateCylinder(t,{height:2,diameterTop:0,diameterBottom:1},this.scene);break;case"plane":i=BABYLON.MeshBuilder.CreatePlane(t,{size:1},this.scene);break;case"torus":i=BABYLON.MeshBuilder.CreateTorus(t,{diameter:1,thickness:.3},this.scene);break;default:return console.warn(`Unknown primitive type: ${e}`),null}i.position=new BABYLON.Vector3(0,1,0);const o=new BABYLON.StandardMaterial(`${t}_mat`,this.scene);return o.diffuseColor=new BABYLON.Color3(Math.random(),Math.random(),Math.random()),i.material=o,console.log(`Created primitive: ${t}`),i}createLight(e){const t=`${e}Light_${this.objectCounter++}`;let i;switch(e.toLowerCase()){case"point":i=new BABYLON.PointLight(t,new BABYLON.Vector3(0,3,0),this.scene);break;case"directional":i=new BABYLON.DirectionalLight(t,new BABYLON.Vector3(0,-1,0),this.scene),i.position=new BABYLON.Vector3(0,5,0);break;case"spot":i=new BABYLON.SpotLight(t,new BABYLON.Vector3(0,3,0),new BABYLON.Vector3(0,-1,0),Math.PI/3,2,this.scene);break;case"hemispheric":i=new BABYLON.HemisphericLight(t,new BABYLON.Vector3(0,1,0),this.scene);break;default:return console.warn(`Unknown light type: ${e}`),null}return i.intensity=.5,console.log(`Created light: ${t}`),i}async importGLTF(e){try{console.log(`Importing GLTF from: ${e}`);const t=await BABYLON.SceneLoader.ImportMeshAsync("","",e,this.scene);if(t.meshes&&t.meshes.length>0){const i=t.meshes[0];return i.name=`imported_${this.objectCounter++}`,i.position=new BABYLON.Vector3(0,0,0),console.log(`Successfully imported GLTF: ${i.name}`),i}else throw new Error("No meshes found in GLTF file")}catch(t){throw console.error("Failed to load GLTF:",t),t}}duplicateObject(e){if(!e)return console.warn("Cannot duplicate null object"),null;let t=null;if(e instanceof BABYLON.Mesh){if(t=e.clone(`${e.name}_copy_${this.objectCounter++}`),t.position=e.position.add(new BABYLON.Vector3(1,0,1)),e.material){const i=e.material.clone(`${t.name}_mat`);t.material=i}console.log(`Duplicated mesh: ${t.name}`)}else if(e instanceof BABYLON.Light){const i=this.getLightType(e);t=this.createLight(i),t.intensity=e.intensity,e.diffuse&&(t.diffuse=e.diffuse.clone()),e.position&&(t.position=e.position.add(new BABYLON.Vector3(1,0,1))),e.direction&&t.direction&&(t.direction=e.direction.clone()),console.log(`Duplicated light: ${t.name}`)}else console.warn(`Cannot duplicate object of type: ${e.constructor.name}`);return t}getLightType(e){return e instanceof BABYLON.PointLight?"point":e instanceof BABYLON.DirectionalLight?"directional":e instanceof BABYLON.SpotLight?"spot":e instanceof BABYLON.HemisphericLight?"hemispheric":"point"}}class C{constructor(e){this.scene=e}serializeScene(){const e={version:"1.0",objects:[]};return this.scene.meshes.forEach(t=>{if(t.name.startsWith("_")||t.name==="floor"||t.name==="ceiling"||t.name.startsWith("wall"))return;const i={type:"mesh",meshType:this.getMeshType(t),name:t.name,position:t.position.asArray(),rotation:t.rotation.asArray(),scaling:t.scaling.asArray()};t.material&&(i.material=this.serializeMaterial(t.material)),e.objects.push(i)}),this.scene.lights.forEach(t=>{if(t.name==="hemisphericLight"||t.name==="pointLight")return;const i={type:"light",lightType:this.getLightType(t),name:t.name,intensity:t.intensity,diffuse:t.diffuse.asArray()};t.position&&(i.position=t.position.asArray()),t.direction&&(i.direction=t.direction.asArray()),e.objects.push(i)}),JSON.stringify(e,null,2)}getMeshType(e){const t=e.name.toLowerCase();return t.includes("box")?"box":t.includes("sphere")?"sphere":t.includes("cylinder")?"cylinder":t.includes("cone")?"cone":t.includes("plane")?"plane":t.includes("torus")?"torus":"box"}getLightType(e){return e instanceof BABYLON.PointLight?"point":e instanceof BABYLON.DirectionalLight?"directional":e instanceof BABYLON.SpotLight?"spot":e instanceof BABYLON.HemisphericLight?"hemispheric":"point"}serializeMaterial(e){const t={};return e.diffuseColor&&(t.diffuseColor=e.diffuseColor.asArray()),e.specularColor&&(t.specularColor=e.specularColor.asArray()),e.emissiveColor&&(t.emissiveColor=e.emissiveColor.asArray()),t}applyMaterialData(e,t){t.diffuseColor&&(e.diffuseColor=BABYLON.Color3.FromArray(t.diffuseColor)),t.specularColor&&(e.specularColor=BABYLON.Color3.FromArray(t.specularColor)),t.emissiveColor&&(e.emissiveColor=BABYLON.Color3.FromArray(t.emissiveColor))}clearScene(){this.scene.meshes.filter(i=>!i.name.startsWith("_")&&i.name!=="floor"&&i.name!=="ceiling"&&!i.name.startsWith("wall")).forEach(i=>{i.material&&i.material.dispose(),i.dispose()}),this.scene.lights.filter(i=>i.name!=="hemisphericLight"&&i.name!=="pointLight").forEach(i=>{i.dispose()})}async deserializeScene(e){const t=JSON.parse(e),i=new m(this.scene);this.clearScene();for(const o of t.objects)if(o.type==="mesh"){const r=i.createPrimitive(o.meshType);r&&(r.name=o.name,r.position.fromArray(o.position),r.rotation.fromArray(o.rotation),r.scaling.fromArray(o.scaling),o.material&&r.material&&this.applyMaterialData(r.material,o.material))}else if(o.type==="light"){const r=i.createLight(o.lightType);r&&(r.name=o.name,r.intensity=o.intensity,r.diffuse.fromArray(o.diffuse),o.position&&r.position&&r.position.fromArray(o.position),o.direction&&r.direction&&r.direction.fromArray(o.direction))}console.log("Scene deserialized successfully")}saveToFile(e="scene.json"){try{const t=this.serializeScene(),i=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(i),r=document.createElement("a");r.href=o,r.download=e,r.click(),URL.revokeObjectURL(o),console.log("Scene saved to file"),alert("Scene saved successfully!")}catch(t){throw console.error("Failed to save scene:",t),t}}async loadFromFile(e){return new Promise((t,i)=>{const o=new FileReader;o.onload=async r=>{try{await this.deserializeScene(r.target.result),t()}catch(s){i(s)}},o.onerror=i,o.readAsText(e)})}}class w{constructor(e,t){this.scene=e,this.canvas=t,this.isEditorMode=!0,this.selectionManager=null,this.objectFactory=null,this.serializationManager=null,this.cameraManager=null,this.objectPalette=null,this.propertyPanel=null,this.sceneHierarchy=null,this.guiTexture=null}initialize(e){this.guiTexture=e,this.selectionManager=new B(this.scene),this.objectFactory=new m(this.scene),this.serializationManager=new C(this.scene),this.cameraManager=new L(this.scene,this.canvas),this.cameraManager.initialize(),this.selectionManager.setupPicking(this.canvas),this.setupKeyboardShortcuts(),console.log("EditorManager initialized")}setupKeyboardShortcuts(){window.addEventListener("keydown",e=>{if(e.key==="e"||e.key==="E"){this.toggleMode();return}this.isEditorMode&&(e.key==="Delete"&&this.deleteSelected(),e.ctrlKey&&(e.key==="d"||e.key==="D")&&(e.preventDefault(),this.duplicateSelected()),e.ctrlKey&&(e.key==="s"||e.key==="S")&&(e.preventDefault(),this.saveScene()),e.ctrlKey&&(e.key==="o"||e.key==="O")&&(e.preventDefault(),this.loadScene()),(e.key==="f"||e.key==="F")&&this.focusOnSelected(),e.key==="Escape"&&this.selectionManager.deselectObject())}),console.log("Keyboard shortcuts registered")}focusOnSelected(){if(this.selectionManager.selectedObject&&this.cameraManager.editorCamera){const e=this.selectionManager.selectedObject.position;this.cameraManager.editorCamera.setTarget(e),console.log(`Focused camera on: ${this.selectionManager.selectedObject.name}`)}}toggleMode(){this.isEditorMode=!this.isEditorMode,this.isEditorMode?this.enterEditorMode():this.enterPlayMode(),console.log(`Mode switched to: ${this.isEditorMode?"Editor":"Play"}`)}enterEditorMode(){this.isEditorMode=!0,this.cameraManager.switchToEditorCamera(),this.guiTexture&&(this.guiTexture.layer.isEnabled=!0),this.objectPalette&&this.objectPalette.show(),this.propertyPanel&&this.propertyPanel.show(),this.sceneHierarchy&&this.sceneHierarchy.show(),this.selectionManager&&this.selectionManager.setupPicking(this.canvas),console.log("Entered editor mode")}enterPlayMode(){this.isEditorMode=!1,this.cameraManager.switchToPlayerCamera(),this.guiTexture&&(this.guiTexture.layer.isEnabled=!1),this.objectPalette&&this.objectPalette.hide(),this.propertyPanel&&this.propertyPanel.hide(),this.sceneHierarchy&&this.sceneHierarchy.hide(),this.selectionManager&&this.selectionManager.deselectObject(),console.log("Entered play mode")}deleteSelected(){const e=this.selectionManager.selectedObject;if(!e){console.warn("No object selected to delete");return}if(["playerCamera","editorCamera","camera","hemisphericLight","pointLight"].includes(e.name)){console.warn(`Cannot delete essential object: ${e.name}`),alert(`Cannot delete essential object: ${e.name}`);return}const i=e.name;this.selectionManager.deselectObject(),e.material&&e.material.dispose(),e.dispose(),this.sceneHierarchy&&this.sceneHierarchy.refresh(),console.log(`Deleted object: ${i}`)}duplicateSelected(){const e=this.selectionManager.selectedObject;if(!e){console.warn("No object selected to duplicate");return}const t=this.objectFactory.duplicateObject(e);t&&(this.selectionManager.selectObject(t),this.sceneHierarchy&&this.sceneHierarchy.refresh(),console.log(`Duplicated object: ${t.name}`))}saveScene(){try{this.serializationManager.saveToFile(),console.log("Scene saved successfully")}catch(e){console.error("Failed to save scene:",e),alert("Failed to save scene. Check console for details.")}}loadScene(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async t=>{const i=t.target.files[0];if(i)try{await this.serializationManager.loadFromFile(i),this.selectionManager.deselectObject(),this.sceneHierarchy&&this.sceneHierarchy.refresh(),console.log("Scene loaded successfully"),alert("Scene loaded successfully")}catch(o){console.error("Failed to load scene:",o),alert("Failed to load scene. Check console for details.")}},e.click()}dispose(){this.selectionManager&&this.selectionManager.dispose()}}class y{constructor(e,t){this.editor=e,this.guiTexture=t,this.panel=null,this.isVisible=!0,this.initialize()}initialize(){this.panel=new BABYLON.GUI.StackPanel,this.panel.width="220px",this.panel.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,this.panel.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,this.panel.paddingTop="10px",this.panel.paddingLeft="10px",this.panel.background="#2a2a2a",this.guiTexture.addControl(this.panel),this.createPrimitiveSection(),this.createLightSection(),this.createModelSection(),console.log("ObjectPalette initialized")}createSectionHeader(e){const t=new BABYLON.GUI.TextBlock;return t.text=e,t.height="30px",t.width="190px",t.color="#4a9eff",t.fontSize=16,t.fontWeight="bold",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.textWrapping=!0,t.paddingLeft="5px",t}createButton(e,t){const i=BABYLON.GUI.Button.CreateSimpleButton(`btn_${e}_${Date.now()}`,e);return i.width="180px",i.height="30px",i.color="white",i.background="#3a3a3a",i.fontSize=14,i.cornerRadius=4,i.onPointerEnterObservable.add(()=>{i.background="#4a4a4a"}),i.onPointerOutObservable.add(()=>{i.background="#3a3a3a"}),i.onPointerClickObservable.add(t),i}createPrimitiveSection(){const e=this.createSectionHeader("Primitives");this.panel.addControl(e),["Box","Sphere","Cylinder","Cone","Plane","Torus"].forEach(o=>{const r=this.createButton(o,()=>{const s=this.editor.objectFactory.createPrimitive(o);s&&(this.editor.selectionManager.selectObject(s),this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh())});this.panel.addControl(r)});const i=new BABYLON.GUI.Container;i.height="10px",this.panel.addControl(i)}createLightSection(){const e=this.createSectionHeader("Lights");this.panel.addControl(e),["Point","Directional","Spot","Hemispheric"].forEach(o=>{const r=this.createButton(o,()=>{const s=this.editor.objectFactory.createLight(o);s&&(this.editor.selectionManager.selectObject(s),this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh())});this.panel.addControl(r)});const i=new BABYLON.GUI.Container;i.height="10px",this.panel.addControl(i)}createModelSection(){const e=this.createSectionHeader("Models");this.panel.addControl(e);const t=this.createButton("Import GLTF",()=>{this.openGLTFImport()});this.panel.addControl(t)}openGLTFImport(){const e=document.createElement("input");e.type="file",e.accept=".gltf,.glb",e.onchange=async t=>{const i=t.target.files[0];if(i)try{console.log("Loading GLTF model...");const o=URL.createObjectURL(i),r=await this.editor.objectFactory.importGLTF(o);r&&(this.editor.selectionManager.selectObject(r),this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh(),console.log("GLTF model imported successfully")),URL.revokeObjectURL(o)}catch(o){console.error("Failed to import GLTF:",o),alert(`Failed to import model: ${o.message}`)}},e.click()}show(){this.panel&&(this.panel.isVisible=!0,this.isVisible=!0)}hide(){this.panel&&(this.panel.isVisible=!1,this.isVisible=!1)}}class O{constructor(e,t){this.editor=e,this.guiTexture=t,this.panel=null,this.currentObject=null,this.propertyControls=[],this.isVisible=!1,this.initialize()}initialize(){const e=new BABYLON.GUI.ScrollViewer;e.width="320px",e.height="600px",e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,e.paddingTop="10px",e.paddingRight="10px",e.background="#2a2a2a",e.thickness=2,e.color="#4a9eff",e.isVisible=!1,this.guiTexture.addControl(e),this.panel=new BABYLON.GUI.StackPanel,this.panel.width="300px",this.panel.background="#2a2a2a",e.addControl(this.panel),this.scrollViewer=e,this.editor.selectionManager.addSelectionCallback(t=>{this.updateForObject(t)}),console.log("PropertyPanel initialized")}updateForObject(e){if(console.log("PropertyPanel.updateForObject called with:",e?e.name:"null"),this.clearControls(),this.currentObject=e,!e){this.scrollViewer.isVisible=!1,console.log("PropertyPanel hidden - no object selected");return}console.log("PropertyPanel showing for object:",e.name),this.scrollViewer.isVisible=!0,this.createHeader(e),e instanceof BABYLON.Mesh?(this.createTransformSection(e),this.createMaterialSection(e)):e instanceof BABYLON.Light&&this.createLightSection(e),this.createDeleteButton()}clearControls(){this.panel&&this.panel.clearControls(),this.propertyControls=[]}createHeader(e){const t=new BABYLON.GUI.TextBlock;t.text=`Object: ${e.name}`,t.height="40px",t.color="#4a9eff",t.fontSize=18,t.fontWeight="bold",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.paddingLeft="5px",this.panel.addControl(t);const i=new BABYLON.GUI.InputText;i.width="280px",i.height="30px",i.color="white",i.background="#3a3a3a",i.text=e.name,i.fontSize=14,i.onTextChangedObservable.add(r=>{const s=r.text.trim();if(s&&s!==e.name){let l=s,a=1;for(;this.editor.scene.getMeshByName(l)||this.editor.scene.getLightByName(l);)l=`${s}_${a}`,a++;e.name=l,t.text=`Object: ${l}`,r.text=l,this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh()}}),this.panel.addControl(i);const o=new BABYLON.GUI.Container;o.height="10px",this.panel.addControl(o)}createMaterialSection(e){if(!e.material)return;this.addSectionHeader("Material");const t=e.material;t.diffuseColor&&this.addColorControl("Diffuse",t.diffuseColor,i=>{t.diffuseColor=i}),t.specularColor&&this.addColorControl("Specular",t.specularColor,i=>{t.specularColor=i}),t.emissiveColor&&this.addColorControl("Emissive",t.emissiveColor,i=>{t.emissiveColor=i})}addColorControl(e,t,i){const o=new BABYLON.GUI.TextBlock;o.text=e+" Color:",o.height="20px",o.color="white",o.fontSize=12,o.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,o.paddingLeft="5px",this.panel.addControl(o),["r","g","b"].forEach(r=>{const s=new BABYLON.GUI.StackPanel;s.height="30px",s.isVertical=!1;const l=new BABYLON.GUI.TextBlock;l.text=r.toUpperCase()+":",l.width="30px",l.color="white",l.fontSize=11,s.addControl(l);const a=new BABYLON.GUI.Slider;a.minimum=0,a.maximum=1,a.value=t[r],a.height="20px",a.width="200px",a.color="#4a9eff",a.background="#3a3a3a",a.onValueChangedObservable.add(g=>{t[r]=g,i(t)}),s.addControl(a);const d=new BABYLON.GUI.TextBlock;d.text=t[r].toFixed(2),d.width="40px",d.color="white",d.fontSize=11,s.addControl(d),a.onValueChangedObservable.add(g=>{d.text=g.toFixed(2)}),this.panel.addControl(s)})}createLightSection(e){this.addSectionHeader("Light Properties");const t=new BABYLON.GUI.StackPanel;t.height="40px",t.isVertical=!1;const i=new BABYLON.GUI.TextBlock;i.text="Intensity:",i.width="80px",i.color="white",i.fontSize=12,t.addControl(i);const o=new BABYLON.GUI.Slider;o.minimum=0,o.maximum=10,o.value=e.intensity,o.height="20px",o.width="150px",o.color="#4a9eff",o.background="#3a3a3a",o.onValueChangedObservable.add(s=>{e.intensity=s}),t.addControl(o);const r=new BABYLON.GUI.TextBlock;r.text=e.intensity.toFixed(2),r.width="50px",r.color="white",r.fontSize=12,t.addControl(r),o.onValueChangedObservable.add(s=>{r.text=s.toFixed(2)}),this.panel.addControl(t),e.diffuse&&this.addColorControl("Light",e.diffuse,s=>{e.diffuse=s})}createDeleteButton(){const e=new BABYLON.GUI.Container;e.height="20px",this.panel.addControl(e);const t=BABYLON.GUI.Button.CreateSimpleButton("deleteBtn","Delete Object");t.width="280px",t.height="35px",t.color="white",t.background="#cc0000",t.fontSize=14,t.cornerRadius=4,t.onPointerEnterObservable.add(()=>{t.background="#ff0000"}),t.onPointerOutObservable.add(()=>{t.background="#cc0000"}),t.onPointerClickObservable.add(()=>{this.editor.deleteSelected()}),this.panel.addControl(t)}show(){this.currentObject&&this.scrollViewer&&(this.scrollViewer.isVisible=!0,this.isVisible=!0)}hide(){this.scrollViewer&&(this.scrollViewer.isVisible=!1,this.isVisible=!1)}createTransformSection(e){this.addSectionHeader("Position"),this.addVector3Control("X",e.position.x,t=>{e.position.x=t}),this.addVector3Control("Y",e.position.y,t=>{e.position.y=t}),this.addVector3Control("Z",e.position.z,t=>{e.position.z=t}),this.addSectionHeader("Rotation"),this.addVector3Control("X",e.rotation.x*180/Math.PI,t=>{e.rotation.x=t*Math.PI/180}),this.addVector3Control("Y",e.rotation.y*180/Math.PI,t=>{e.rotation.y=t*Math.PI/180}),this.addVector3Control("Z",e.rotation.z*180/Math.PI,t=>{e.rotation.z=t*Math.PI/180}),this.addSectionHeader("Scale"),this.addVector3Control("X",e.scaling.x,t=>{e.scaling.x=t}),this.addVector3Control("Y",e.scaling.y,t=>{e.scaling.y=t}),this.addVector3Control("Z",e.scaling.z,t=>{e.scaling.z=t})}addSectionHeader(e){const t=new BABYLON.GUI.TextBlock;t.text=e,t.height="25px",t.color="white",t.fontSize=14,t.fontWeight="bold",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.paddingLeft="5px",this.panel.addControl(t)}addVector3Control(e,t,i){const o=new BABYLON.GUI.StackPanel;o.height="30px",o.isVertical=!1;const r=new BABYLON.GUI.TextBlock;r.text=e+":",r.width="30px",r.color="white",r.fontSize=12,r.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,o.addControl(r);const s=new BABYLON.GUI.InputText;s.width="240px",s.height="25px",s.color="white",s.background="#3a3a3a",s.text=t.toFixed(2),s.fontSize=12,s.onTextChangedObservable.add(l=>{const a=parseFloat(l.text);isNaN(a)||i(a)}),o.addControl(s),this.panel.addControl(o)}}class b{constructor(e,t){this.editor=e,this.guiTexture=t,this.panel=null,this.objectButtons=new Map,this.isVisible=!0,this.initialize()}initialize(){this.panel=new BABYLON.GUI.StackPanel,this.panel.width="220px",this.panel.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,this.panel.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,this.panel.paddingTop="500px",this.panel.paddingLeft="10px",this.panel.background="#2a2a2a",this.guiTexture.addControl(this.panel),this.editor.selectionManager.addSelectionCallback(e=>{this.highlightSelected(e)}),this.refresh(),console.log("SceneHierarchy initialized")}refresh(){this.panel.clearControls(),this.objectButtons.clear();const e=new BABYLON.GUI.TextBlock;e.text="Scene Hierarchy",e.height="30px",e.width="190px",e.color="#4a9eff",e.fontSize=16,e.fontWeight="bold",e.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,e.textWrapping=!0,e.paddingLeft="5px",this.panel.addControl(e);const t=this.editor.scene.meshes.filter(o=>!o.name.startsWith("_")),i=this.editor.scene.lights;this.addSection("Meshes",t),this.addSection("Lights",i)}addSection(e,t){if(t.length===0)return;const i=new BABYLON.GUI.TextBlock;i.text=e,i.height="25px",i.color="white",i.fontSize=14,i.fontWeight="bold",i.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,i.paddingLeft="5px",this.panel.addControl(i),t.forEach(r=>{const s=this.createObjectButton(r);this.panel.addControl(s),this.objectButtons.set(r,s)});const o=new BABYLON.GUI.Container;o.height="5px",this.panel.addControl(o)}createObjectButton(e){const t=BABYLON.GUI.Button.CreateSimpleButton(`hierarchy_${e.name}_${Date.now()}`,e.name);return t.width="180px",t.height="25px",t.color="white",t.background="#333",t.fontSize=12,t.cornerRadius=2,t.paddingLeft="10px",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.onPointerEnterObservable.add(()=>{this.editor.selectionManager.selectedObject!==e&&(t.background="#444")}),t.onPointerOutObservable.add(()=>{this.editor.selectionManager.selectedObject!==e&&(t.background="#333")}),t.onPointerClickObservable.add(()=>{this.editor.selectionManager.selectObject(e)}),t}highlightSelected(e){this.objectButtons.forEach((t,i)=>{i===e?t.background="#4a9eff":t.background="#333"})}show(){this.panel&&(this.panel.isVisible=!0,this.isVisible=!0)}hide(){this.panel&&(this.panel.isVisible=!1,this.isVisible=!1)}}let u=null,h=null,p=null,A=Date.now(),c=null;window.addEventListener("DOMContentLoaded",()=>{E()});function N(n){const e=BABYLON.MeshBuilder.CreateGround("floor",{width:20,height:20},n);e.position.y=0;const t=BABYLON.MeshBuilder.CreateGround("ceiling",{width:20,height:20},n);t.position.y=3,t.rotation.z=Math.PI;const i=BABYLON.MeshBuilder.CreateBox("wallNorth",{width:20,height:3,depth:.5},n);i.position=new BABYLON.Vector3(0,1.5,10);const o=BABYLON.MeshBuilder.CreateBox("wallSouth",{width:20,height:3,depth:.5},n);o.position=new BABYLON.Vector3(0,1.5,-10);const r=BABYLON.MeshBuilder.CreateBox("wallEast",{width:.5,height:3,depth:20},n);r.position=new BABYLON.Vector3(10,1.5,0);const s=BABYLON.MeshBuilder.CreateBox("wallWest",{width:.5,height:3,depth:20},n);return s.position=new BABYLON.Vector3(-10,1.5,0),console.log("Room environment geometry created"),{floor:e,ceiling:t,walls:[i,o,r,s]}}function x(n,e){const t=new BABYLON.StandardMaterial("floorMat",e);t.diffuseColor=new BABYLON.Color3(.1,.1,.1),t.specularColor=new BABYLON.Color3(.01,.01,.01),n.floor.material=t;const i=new BABYLON.StandardMaterial("ceilingMat",e);i.diffuseColor=new BABYLON.Color3(.05,.05,.05),i.specularColor=new BABYLON.Color3(.01,.01,.01),n.ceiling.material=i;const o=new BABYLON.StandardMaterial("wallMat",e);o.diffuseColor=new BABYLON.Color3(.165,.165,.165),o.specularColor=new BABYLON.Color3(.01,.01,.01),n.walls.forEach(r=>{r.material=o}),console.log("Spooky materials applied to room meshes")}function M(n){const e=new BABYLON.HemisphericLight("hemisphericLight",new BABYLON.Vector3(0,1,0),n);e.intensity=.3,e.diffuse=new BABYLON.Color3(.5,.5,.6),e.specular=new BABYLON.Color3(.1,.1,.15),e.groundColor=new BABYLON.Color3(.1,.1,.1);const t=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(0,2,0),n);return t.intensity=.5,t.diffuse=new BABYLON.Color3(1,.7,.4),t.specular=new BABYLON.Color3(.5,.35,.2),t.range=15,console.log("Atmospheric lighting system initialized"),{hemisphericLight:e,pointLight:t}}function S(){const n={webglSupported:!1,webgl2Supported:!1,browserName:"Unknown",browserVersion:"Unknown",compatible:!1,warnings:[]},e=navigator.userAgent;e.indexOf("Chrome")>-1&&e.indexOf("Edg")===-1?n.browserName="Chrome":e.indexOf("Firefox")>-1?n.browserName="Firefox":e.indexOf("Edg")>-1?n.browserName="Edge":e.indexOf("Safari")>-1&&(n.browserName="Safari");const t=document.createElement("canvas"),i=t.getContext("webgl")||t.getContext("experimental-webgl"),o=t.getContext("webgl2");return i&&(n.webglSupported=!0),o&&(n.webgl2Supported=!0),n.webgl2Supported?(n.compatible=!0,console.log("✓ WebGL 2.0 supported")):n.webglSupported?(n.compatible=!0,n.warnings.push("WebGL 2.0 not supported, falling back to WebGL 1.0"),console.warn("⚠ WebGL 2.0 not supported, using WebGL 1.0 fallback")):(n.compatible=!1,console.error("✗ WebGL not supported")),["Chrome","Firefox","Edge"].includes(n.browserName)||n.warnings.push(`Browser ${n.browserName} may not be fully supported. Recommended: Chrome, Firefox, or Edge`),console.log(`Browser: ${n.browserName}, WebGL: ${n.webglSupported}, WebGL2: ${n.webgl2Supported}`),n}function Y(){const n=document.createElement("div");return n.id="fps-counter",n.style.cssText=`
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: #00ff00;
    padding: 8px 12px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    z-index: 1000;
    min-width: 80px;
  `,n.textContent="FPS: --",document.body.appendChild(n),n}function T(){if(p&&u){const n=u.getFps().toFixed(0);p.textContent=`FPS: ${n}`,n>=50?p.style.color="#00ff00":n>=30?p.style.color="#ffff00":p.style.color="#ff0000"}}function I(){const n=(Date.now()-A)/1e3;return console.log(`Game loaded in ${n.toFixed(2)} seconds`),n>5?console.warn(`⚠ Load time (${n.toFixed(2)}s) exceeds target of 5 seconds`):console.log("✓ Load time within target (< 5 seconds)"),n}function E(){try{const n=S();if(!n.compatible){f("WebGL is not supported in your browser. Please use a modern browser like Chrome, Firefox, or Edge.");return}n.warnings.length>0&&n.warnings.forEach(o=>{console.warn(o)});const e=document.getElementById("renderCanvas");if(!e){console.error("Canvas element not found"),f("Failed to initialize: Canvas element not found");return}try{u=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!n.webgl2Supported})}catch(o){console.error("Failed to create Babylon.js engine:",o),f("WebGL not supported or failed to initialize. Please use a modern browser.");return}h=new BABYLON.Scene(u),h.clearColor=new BABYLON.Color3(.01,.01,.02);const t=N(h);x(t,h),M(h);const i=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");c=new w(h,e),c.initialize(i),c.objectPalette=new y(c,i),c.propertyPanel=new O(c,i),c.sceneHierarchy=new b(c,i),c.enterEditorMode(),window.addEventListener("resize",()=>{u.resize()}),console.log("Spooky Game - Engine and scene initialized successfully"),p=Y(),I(),u.runRenderLoop(()=>{try{h.render(),T()}catch(o){console.error("Render error:",o)}})}catch(n){console.error("Unexpected error during initialization:",n),f("An unexpected error occurred during initialization")}}function f(n){let e=document.getElementById("error-message");e||(e=document.createElement("div"),e.id="error-message",e.style.cssText="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #ff0000; color: #ffffff; padding: 20px; border-radius: 5px; font-family: Arial, sans-serif; z-index: 1000;",document.body.appendChild(e)),e.textContent=n}
