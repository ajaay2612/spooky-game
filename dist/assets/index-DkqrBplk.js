(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();class B{constructor(e,t=null){this.scene=e,this.editorManager=t,this.selectedObject=null,this.highlightLayer=null,this.onSelectionChanged=null,this.selectionCallbacks=[],this.initialize()}initialize(){this.highlightLayer=new BABYLON.HighlightLayer("highlight",this.scene),this.highlightLayer.outerGlow=!0,this.highlightLayer.innerGlow=!1,console.log("SelectionManager initialized with HighlightLayer")}setupPicking(e){this.scene.onPointerDown=(t,i)=>{this.editorManager&&!this.editorManager.isEditorMode||t.button===0&&(i.hit&&i.pickedMesh?i.pickedMesh.name.startsWith("_")||this.selectObject(i.pickedMesh):this.deselectObject())},console.log("Mouse picking enabled for object selection")}selectObject(e){if(!e||e.isDisposed()){console.warn("Cannot select invalid or disposed object");return}this.selectedObject&&this.selectedObject instanceof BABYLON.Mesh&&this.highlightLayer.removeMesh(this.selectedObject),this.selectedObject=e,e instanceof BABYLON.Mesh&&this.highlightLayer.addMesh(e,BABYLON.Color3.Yellow()),this.onSelectionChanged&&this.onSelectionChanged(e),this.selectionCallbacks.forEach(t=>t(e)),console.log(`Selected object: ${e.name}`)}deselectObject(){this.selectedObject&&(this.selectedObject instanceof BABYLON.Mesh&&this.highlightLayer.removeMesh(this.selectedObject),console.log(`Deselected object: ${this.selectedObject.name}`),this.selectedObject=null,this.onSelectionChanged&&this.onSelectionChanged(null),this.selectionCallbacks.forEach(e=>e(null)))}addSelectionCallback(e){e&&typeof e=="function"&&this.selectionCallbacks.push(e)}dispose(){this.highlightLayer&&(this.highlightLayer.dispose(),this.highlightLayer=null)}}class w{constructor(e,t){this.scene=e,this.canvas=t,this.editorCamera=null,this.playerCamera=null,this.activeCamera=null}createPlayerCamera(){const e=new BABYLON.UniversalCamera("playerCamera",new BABYLON.Vector3(0,1.6,-5),this.scene);return e.setTarget(new BABYLON.Vector3(0,1.6,0)),e.speed=.1,e.angularSensibility=2e3,e.keysUp=[87],e.keysDown=[83],e.keysLeft=[65],e.keysRight=[68],console.log("Player camera (UniversalCamera) created"),this.playerCamera=e,e}createEditorCamera(){const e=new BABYLON.ArcRotateCamera("editorCamera",Math.PI/2,Math.PI/3,15,new BABYLON.Vector3(0,1.5,0),this.scene);return e.panningSensibility=1e3,e.wheelPrecision=50,e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.lowerRadiusLimit=2,e.upperRadiusLimit=100,e.lowerBetaLimit=.1,e.upperBetaLimit=Math.PI/2,e.inputs.attached.pointers.buttons=[2,1,0],console.log("Editor camera (ArcRotateCamera) created"),this.editorCamera=e,e}switchToEditorCamera(){this.editorCamera||this.createEditorCamera(),document.pointerLockElement===this.canvas&&document.exitPointerLock(),this.playerCamera&&this.playerCamera.detachControl(),this.editorCamera.attachControl(this.canvas,!0),this.scene.activeCamera=this.editorCamera,this.activeCamera=this.editorCamera,console.log("Switched to editor camera")}switchToPlayerCamera(){this.playerCamera||this.createPlayerCamera(),this.editorCamera&&this.editorCamera.detachControl(),this.playerCamera.attachControl(this.canvas,!0),this.scene.activeCamera=this.playerCamera,this.activeCamera=this.playerCamera,this.canvas.requestPointerLock(),console.log("Switched to player camera")}initialize(){this.createPlayerCamera(),this.createEditorCamera(),this.switchToEditorCamera()}}class f{constructor(e){this.scene=e,this.objectCounter=0}createPrimitive(e){const t=`${e}_${this.objectCounter++}`;let i;switch(e.toLowerCase()){case"box":i=BABYLON.MeshBuilder.CreateBox(t,{size:1},this.scene);break;case"sphere":i=BABYLON.MeshBuilder.CreateSphere(t,{diameter:1},this.scene);break;case"cylinder":i=BABYLON.MeshBuilder.CreateCylinder(t,{height:2,diameter:1},this.scene);break;case"cone":i=BABYLON.MeshBuilder.CreateCylinder(t,{height:2,diameterTop:0,diameterBottom:1},this.scene);break;case"plane":i=BABYLON.MeshBuilder.CreatePlane(t,{size:1},this.scene);break;case"torus":i=BABYLON.MeshBuilder.CreateTorus(t,{diameter:1,thickness:.3},this.scene);break;default:return console.warn(`Unknown primitive type: ${e}`),null}i.position=new BABYLON.Vector3(0,1,0);const o=new BABYLON.StandardMaterial(`${t}_mat`,this.scene);return o.diffuseColor=new BABYLON.Color3(Math.random(),Math.random(),Math.random()),i.material=o,console.log(`Created primitive: ${t}`),i}createLight(e){const t=`${e}Light_${this.objectCounter++}`;let i;switch(e.toLowerCase()){case"point":i=new BABYLON.PointLight(t,new BABYLON.Vector3(0,3,0),this.scene);break;case"directional":i=new BABYLON.DirectionalLight(t,new BABYLON.Vector3(0,-1,0),this.scene),i.position=new BABYLON.Vector3(0,5,0);break;case"spot":i=new BABYLON.SpotLight(t,new BABYLON.Vector3(0,3,0),new BABYLON.Vector3(0,-1,0),Math.PI/3,2,this.scene);break;case"hemispheric":i=new BABYLON.HemisphericLight(t,new BABYLON.Vector3(0,1,0),this.scene);break;default:return console.warn(`Unknown light type: ${e}`),null}return i.intensity=.5,console.log(`Created light: ${t}`),i}async importGLTF(e){try{console.log(`Importing GLTF from: ${e}`);const t=await BABYLON.SceneLoader.ImportMeshAsync("","",e,this.scene);if(t.meshes&&t.meshes.length>0){const i=t.meshes[0];return i.name=`imported_${this.objectCounter++}`,i.position=new BABYLON.Vector3(0,0,0),console.log(`Successfully imported GLTF: ${i.name}`),i}else throw new Error("No meshes found in GLTF file")}catch(t){throw console.error("Failed to load GLTF:",t),t}}duplicateObject(e){if(!e)return console.warn("Cannot duplicate null object"),null;let t=null;if(e instanceof BABYLON.Mesh){if(t=e.clone(`${e.name}_copy_${this.objectCounter++}`),t.position=e.position.add(new BABYLON.Vector3(1,0,1)),e.material){const i=e.material.clone(`${t.name}_mat`);t.material=i}console.log(`Duplicated mesh: ${t.name}`)}else if(e instanceof BABYLON.Light){const i=this.getLightType(e);t=this.createLight(i),t.intensity=e.intensity,e.diffuse&&(t.diffuse=e.diffuse.clone()),e.position&&(t.position=e.position.add(new BABYLON.Vector3(1,0,1))),e.direction&&t.direction&&(t.direction=e.direction.clone()),console.log(`Duplicated light: ${t.name}`)}else console.warn(`Cannot duplicate object of type: ${e.constructor.name}`);return t}getLightType(e){return e instanceof BABYLON.PointLight?"point":e instanceof BABYLON.DirectionalLight?"directional":e instanceof BABYLON.SpotLight?"spot":e instanceof BABYLON.HemisphericLight?"hemispheric":"point"}}class C{constructor(e){this.scene=e}serializeScene(){const e={version:"1.0",objects:[]};return this.scene.meshes.forEach(t=>{if(t.name.startsWith("_")||t.name==="floor"||t.name==="ceiling"||t.name.startsWith("wall"))return;const i={type:"mesh",meshType:this.getMeshType(t),name:t.name,position:t.position.asArray(),rotation:t.rotation.asArray(),scaling:t.scaling.asArray()};t.material&&(i.material=this.serializeMaterial(t.material)),e.objects.push(i)}),this.scene.lights.forEach(t=>{const i={type:"light",lightType:this.getLightType(t),name:t.name,intensity:t.intensity,diffuse:t.diffuse.asArray()};t.specular&&(i.specular=t.specular.asArray()),t.groundColor&&(i.groundColor=t.groundColor.asArray()),t.position&&(i.position=t.position.asArray()),t.direction&&(i.direction=t.direction.asArray()),t.range!==void 0&&(i.range=t.range),e.objects.push(i)}),JSON.stringify(e,null,2)}getMeshType(e){const t=e.name.toLowerCase();return t.includes("box")?"box":t.includes("sphere")?"sphere":t.includes("cylinder")?"cylinder":t.includes("cone")?"cone":t.includes("plane")?"plane":t.includes("torus")?"torus":"box"}getLightType(e){return e instanceof BABYLON.PointLight?"point":e instanceof BABYLON.DirectionalLight?"directional":e instanceof BABYLON.SpotLight?"spot":e instanceof BABYLON.HemisphericLight?"hemispheric":"point"}serializeMaterial(e){const t={};return e.diffuseColor&&(t.diffuseColor=e.diffuseColor.asArray()),e.specularColor&&(t.specularColor=e.specularColor.asArray()),e.emissiveColor&&(t.emissiveColor=e.emissiveColor.asArray()),t}applyMaterialData(e,t){t.diffuseColor&&(e.diffuseColor=BABYLON.Color3.FromArray(t.diffuseColor)),t.specularColor&&(e.specularColor=BABYLON.Color3.FromArray(t.specularColor)),t.emissiveColor&&(e.emissiveColor=BABYLON.Color3.FromArray(t.emissiveColor))}clearScene(){this.scene.meshes.filter(i=>!i.name.startsWith("_")&&i.name!=="floor"&&i.name!=="ceiling"&&!i.name.startsWith("wall")).forEach(i=>{i.material&&i.material.dispose(),i.dispose()}),[...this.scene.lights].forEach(i=>{i.dispose()})}async deserializeScene(e){const t=JSON.parse(e),i=new f(this.scene);this.clearScene();for(const o of t.objects)if(o.type==="mesh"){const n=i.createPrimitive(o.meshType);n&&(n.name=o.name,n.position.fromArray(o.position),n.rotation.fromArray(o.rotation),n.scaling.fromArray(o.scaling),o.material&&n.material&&this.applyMaterialData(n.material,o.material))}else if(o.type==="light"){const n=i.createLight(o.lightType);n&&(n.name=o.name,n.intensity=o.intensity,n.diffuse.fromArray(o.diffuse),o.specular&&n.specular&&n.specular.fromArray(o.specular),o.groundColor&&n.groundColor&&n.groundColor.fromArray(o.groundColor),o.position&&n.position&&n.position.fromArray(o.position),o.direction&&n.direction&&n.direction.fromArray(o.direction),o.range!==void 0&&n.range!==void 0&&(n.range=o.range))}console.log("Scene deserialized successfully")}async saveToFile(){try{console.log("Starting scene save...");const e=this.serializeScene();console.log("Scene serialized, sending to server...");const t=await fetch("http://localhost:3001/api/save-scene",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})});console.log("Server response received:",t.status);const i=await t.json();if(console.log("Server result:",i),i.success)console.log("✓ Scene saved to project root as saved-3d-env.json"),alert("Scene saved successfully to saved-3d-env.json!");else throw new Error(i.error)}catch(e){throw console.error("✗ Failed to save scene:",e),alert(`Failed to save scene: ${e.message}
Make sure the server is running (npm run server)`),e}}async loadFromFile(){try{console.log("Starting scene load...");const e=await fetch("http://localhost:3001/api/load-scene");console.log("Server response received:",e.status);const t=await e.json();if(console.log("Server result:",t),t.success)console.log("Deserializing scene data..."),await this.deserializeScene(t.data),console.log("✓ Scene loaded from saved-3d-env.json"),alert("Scene loaded successfully!");else throw new Error(t.error)}catch(e){throw console.error("✗ Failed to load scene:",e),alert(`Failed to load scene: ${e.message}
Make sure the server is running and a scene has been saved.`),e}}}class L{constructor(e,t){this.scene=e,this.canvas=t,this.isEditorMode=!0,this.selectionManager=null,this.objectFactory=null,this.serializationManager=null,this.cameraManager=null,this.objectPalette=null,this.propertyPanel=null,this.sceneHierarchy=null,this.guiTexture=null,this.gizmoManager=null,this.activeGizmo=null,this.lightHelpers=new Map}initialize(e){this.guiTexture=e,this.selectionManager=new B(this.scene,this),this.objectFactory=new f(this.scene),this.serializationManager=new C(this.scene),this.cameraManager=new w(this.scene,this.canvas),this.cameraManager.initialize(),this.selectionManager.setupPicking(this.canvas),this.initializeGizmos(),this.selectionManager.addSelectionCallback(t=>{this.updateGizmoAttachment()}),this.setupKeyboardShortcuts(),console.log("EditorManager initialized")}initializeGizmos(){this.gizmoManager=new BABYLON.GizmoManager(this.scene),this.gizmoManager.usePointerToAttachGizmos=!1,this.gizmoManager.scaleRatio=1,this.gizmoManager.gizmoCoordinatesMode=BABYLON.GizmoCoordinatesMode.Local,this.gizmoManager.positionGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1,this.gizmoManager.rotationGizmoEnabled=!1,console.log("Gizmo system initialized"),console.log("GizmoManager:",this.gizmoManager)}setGizmoMode(e){this.gizmoManager.positionGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1;const t=this.selectionManager.selectedObject;if(!e||!t){this.activeGizmo=null,this.gizmoManager.attachToMesh(null);return}e==="move"?(this.gizmoManager.positionGizmoEnabled=!0,this.gizmoManager.attachToMesh(t),this.activeGizmo="move",console.log("Position gizmo enabled for:",t.name)):e==="scale"&&(this.gizmoManager.scaleGizmoEnabled=!0,this.gizmoManager.attachToMesh(t),this.activeGizmo="scale",setTimeout(()=>{if(this.gizmoManager.gizmos&&this.gizmoManager.gizmos.scaleGizmo){const i=this.propertyPanel?this.propertyPanel.uniformScaling:!0,o=this.gizmoManager.gizmos.scaleGizmo;i?(o.xGizmo&&(o.xGizmo.isEnabled=!1),o.yGizmo&&(o.yGizmo.isEnabled=!1),o.zGizmo&&(o.zGizmo.isEnabled=!1),o.uniformScaleGizmo&&(o.uniformScaleGizmo.isEnabled=!0)):(o.xGizmo&&(o.xGizmo.isEnabled=!0),o.yGizmo&&(o.yGizmo.isEnabled=!0),o.zGizmo&&(o.zGizmo.isEnabled=!0),o.uniformScaleGizmo&&(o.uniformScaleGizmo.isEnabled=!1)),console.log("Scale gizmo configured - uniform mode:",i)}},10),console.log("Scale gizmo enabled for:",t.name))}updateScaleGizmoUniformMode(e){if(console.log("updateScaleGizmoUniformMode called with:",e),this.gizmoManager&&this.gizmoManager.gizmos&&this.gizmoManager.gizmos.scaleGizmo){const t=this.gizmoManager.gizmos.scaleGizmo;e?(t.xGizmo&&(t.xGizmo.isEnabled=!1),t.yGizmo&&(t.yGizmo.isEnabled=!1),t.zGizmo&&(t.zGizmo.isEnabled=!1),t.uniformScaleGizmo&&(t.uniformScaleGizmo.isEnabled=!0),console.log("Uniform scaling enabled - showing center gizmo only")):(t.xGizmo&&(t.xGizmo.isEnabled=!0),t.yGizmo&&(t.yGizmo.isEnabled=!0),t.zGizmo&&(t.zGizmo.isEnabled=!0),t.uniformScaleGizmo&&(t.uniformScaleGizmo.isEnabled=!1),console.log("Non-uniform scaling enabled - showing axis gizmos"))}else console.warn("Scale gizmo not available")}setupKeyboardShortcuts(){window.addEventListener("keydown",e=>{if(e.key==="e"||e.key==="E"){this.toggleMode();return}this.isEditorMode&&(e.key==="Delete"&&this.deleteSelected(),e.ctrlKey&&(e.key==="d"||e.key==="D")&&(e.preventDefault(),this.duplicateSelected()),e.ctrlKey&&(e.key==="s"||e.key==="S")&&(e.preventDefault(),this.saveScene()),e.ctrlKey&&(e.key==="o"||e.key==="O")&&(e.preventDefault(),this.loadScene()),(e.key==="f"||e.key==="F")&&this.focusOnSelected(),e.key==="Escape"&&this.selectionManager.deselectObject())}),console.log("Keyboard shortcuts registered")}focusOnSelected(){if(this.selectionManager.selectedObject&&this.cameraManager.editorCamera){const e=this.selectionManager.selectedObject.position;this.cameraManager.editorCamera.setTarget(e),console.log(`Focused camera on: ${this.selectionManager.selectedObject.name}`)}}toggleMode(){this.isEditorMode=!this.isEditorMode,this.isEditorMode?this.enterEditorMode():this.enterPlayMode(),console.log(`Mode switched to: ${this.isEditorMode?"Editor":"Play"}`)}enterEditorMode(){this.isEditorMode=!0,this.cameraManager.switchToEditorCamera(),this.guiTexture&&(this.guiTexture.layer.isEnabled=!0),this.objectPalette&&this.objectPalette.show(),this.propertyPanel&&this.propertyPanel.show(),this.sceneHierarchy&&this.sceneHierarchy.show(),this.selectionManager&&this.selectionManager.setupPicking(this.canvas),console.log("Entered editor mode")}enterPlayMode(){this.isEditorMode=!1,this.cameraManager.switchToPlayerCamera(),this.guiTexture&&(this.guiTexture.layer.isEnabled=!1),this.objectPalette&&this.objectPalette.hide(),this.propertyPanel&&this.propertyPanel.hide(),this.sceneHierarchy&&this.sceneHierarchy.hide(),this.selectionManager&&this.selectionManager.deselectObject(),console.log("Entered play mode")}deleteSelected(){const e=this.selectionManager.selectedObject;if(!e){console.warn("No object selected to delete");return}if(["playerCamera","editorCamera","camera","hemisphericLight","pointLight"].includes(e.name)){console.warn(`Cannot delete essential object: ${e.name}`),alert(`Cannot delete essential object: ${e.name}`);return}const i=e.name;this.gizmoManager&&this.gizmoManager.attachToMesh(null),this.selectionManager.deselectObject(),e.material&&e.material.dispose(),e.dispose(),this.sceneHierarchy&&this.sceneHierarchy.refresh(),console.log(`Deleted object: ${i}`)}duplicateSelected(){const e=this.selectionManager.selectedObject;if(!e){console.warn("No object selected to duplicate");return}const t=this.objectFactory.duplicateObject(e);t&&(this.selectionManager.selectObject(t),this.sceneHierarchy&&this.sceneHierarchy.refresh(),console.log(`Duplicated object: ${t.name}`))}async saveScene(){try{await this.serializationManager.saveToFile(),console.log("Scene saved successfully")}catch(e){console.error("Failed to save scene:",e)}}async loadScene(){try{await this.serializationManager.loadFromFile(),this.selectionManager.deselectObject(),this.sceneHierarchy&&this.sceneHierarchy.refresh(),console.log("Scene loaded successfully")}catch(e){console.error("Failed to load scene:",e)}}setLightGizmoMode(e,t){if(this.gizmoManager.positionGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1,!e||!t){this.activeGizmo=null,this.gizmoManager.attachToMesh(null),this.lightHelpers.has(t)&&(this.lightHelpers.get(t).dispose(),this.lightHelpers.delete(t));return}let i=this.lightHelpers.get(t);if(i||(i=BABYLON.MeshBuilder.CreateSphere(`_lightHelper_${t.name}`,{diameter:.3},this.scene),i.isVisible=!1,i.isPickable=!1,this.scene.onBeforeRenderObservable.add(()=>{t.position&&i&&i.position.copyFrom(t.position)}),this.lightHelpers.set(t,i)),t.position&&i.position.copyFrom(t.position),e==="move"){this.gizmoManager.positionGizmoEnabled=!0,this.gizmoManager.attachToMesh(i),this.activeGizmo="move";const o=this.gizmoManager.gizmos.positionGizmo;o&&o.onDragEndObservable.add(()=>{t.position&&t.position.copyFrom(i.position)}),console.log("Position gizmo enabled for light:",t.name)}}updateGizmoAttachment(){const e=this.selectionManager.selectedObject;this.activeGizmo&&this.gizmoManager&&this.gizmoManager.attachToMesh(e)}dispose(){this.selectionManager&&this.selectionManager.dispose(),this.gizmoManager&&this.gizmoManager.dispose(),this.lightHelpers.forEach(e=>e.dispose()),this.lightHelpers.clear()}}class O{constructor(e,t){this.editor=e,this.guiTexture=t,this.panel=null,this.scrollViewer=null,this.isVisible=!0,this.initialize()}initialize(){this.scrollViewer=new BABYLON.GUI.ScrollViewer,this.scrollViewer.width="240px",this.scrollViewer.height="45%",this.scrollViewer.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,this.scrollViewer.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,this.scrollViewer.top="10px",this.scrollViewer.left="10px",this.scrollViewer.background="#2a2a2a",this.scrollViewer.thickness=2,this.scrollViewer.thumbLength=.5,this.scrollViewer.barColor="#4a9eff",this.scrollViewer.barBackground="#1a1a1a",this.scrollViewer.isPointerBlocker=!0,this.guiTexture.addControl(this.scrollViewer),this.panel=new BABYLON.GUI.StackPanel,this.panel.width="200px",this.scrollViewer.addControl(this.panel),this.createFileSection(),this.createPrimitiveSection(),this.createLightSection(),this.createModelSection(),console.log("ObjectPalette initialized with 45% height and scrolling")}createFileSection(){const e=this.createSectionHeader("File");this.panel.addControl(e);const t=this.createButton("Save Scene",()=>{this.editor.saveScene()});this.panel.addControl(t);const i=this.createButton("Load Scene",()=>{this.editor.loadScene()});this.panel.addControl(i);const o=new BABYLON.GUI.Container;o.height="10px",this.panel.addControl(o)}createSectionHeader(e){const t=new BABYLON.GUI.TextBlock;return t.text=e,t.height="30px",t.width="190px",t.color="#4a9eff",t.fontSize=16,t.fontWeight="bold",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.textWrapping=!0,t.paddingLeft="5px",t}createButton(e,t){const i=BABYLON.GUI.Button.CreateSimpleButton(`btn_${e}_${Date.now()}`,e);return i.width="180px",i.height="30px",i.color="white",i.background="#3a3a3a",i.fontSize=14,i.cornerRadius=4,i.onPointerEnterObservable.add(()=>{i.background="#4a4a4a"}),i.onPointerOutObservable.add(()=>{i.background="#3a3a3a"}),i.onPointerClickObservable.add(t),i}createPrimitiveSection(){const e=this.createSectionHeader("Primitives");this.panel.addControl(e),["Box","Sphere","Cylinder","Cone","Plane","Torus"].forEach(o=>{const n=this.createButton(o,()=>{const s=this.editor.objectFactory.createPrimitive(o);s&&(this.editor.selectionManager.selectObject(s),this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh())});this.panel.addControl(n)});const i=new BABYLON.GUI.Container;i.height="10px",this.panel.addControl(i)}createLightSection(){const e=this.createSectionHeader("Lights");this.panel.addControl(e),["Point","Directional","Spot","Hemispheric"].forEach(o=>{const n=this.createButton(o,()=>{const s=this.editor.objectFactory.createLight(o);s&&(this.editor.selectionManager.selectObject(s),this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh())});this.panel.addControl(n)});const i=new BABYLON.GUI.Container;i.height="10px",this.panel.addControl(i)}createModelSection(){const e=this.createSectionHeader("Models");this.panel.addControl(e);const t=this.createButton("Import GLTF",()=>{this.openGLTFImport()});this.panel.addControl(t)}openGLTFImport(){const e=document.createElement("input");e.type="file",e.accept=".gltf,.glb",e.onchange=async t=>{const i=t.target.files[0];if(i)try{console.log("Loading GLTF model...");const o=URL.createObjectURL(i),n=await this.editor.objectFactory.importGLTF(o);n&&(this.editor.selectionManager.selectObject(n),this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh(),console.log("GLTF model imported successfully")),URL.revokeObjectURL(o)}catch(o){console.error("Failed to import GLTF:",o),alert(`Failed to import model: ${o.message}`)}},e.click()}show(){this.scrollViewer&&(this.scrollViewer.isVisible=!0,this.isVisible=!0)}hide(){this.scrollViewer&&(this.scrollViewer.isVisible=!1,this.isVisible=!1)}}class y{constructor(e,t){this.editor=e,this.guiTexture=t,this.panel=null,this.currentObject=null,this.propertyControls=[],this.isVisible=!1,this.activeGizmoMode=null,this.uniformScaling=!0,this.moveButton=null,this.scaleButton=null,this.uniformScaleCheckbox=null,this.initialize()}initialize(){const e=new BABYLON.GUI.ScrollViewer;e.width="320px",e.height="600px",e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,e.paddingTop="10px",e.paddingRight="10px",e.background="#2a2a2a",e.thickness=2,e.color="#4a9eff",e.isVisible=!1,this.guiTexture.addControl(e),this.panel=new BABYLON.GUI.StackPanel,this.panel.width="300px",this.panel.background="#2a2a2a",e.isPointerBlocker=!0,e.addControl(this.panel),this.scrollViewer=e,this.editor.selectionManager.addSelectionCallback(t=>{this.updateForObject(t)}),console.log("PropertyPanel initialized")}updateForObject(e){if(console.log("PropertyPanel.updateForObject called with:",e?e.name:"null"),this.clearControls(),this.currentObject=e,!e){this.scrollViewer.isVisible=!1,console.log("PropertyPanel hidden - no object selected");return}console.log("PropertyPanel showing for object:",e.name),this.scrollViewer.isVisible=!0,this.createHeader(e),e instanceof BABYLON.Mesh?(this.createTransformSection(e),this.createMaterialSection(e)):e instanceof BABYLON.Light&&this.createLightSection(e),this.createDeleteButton()}clearControls(){this.panel&&this.panel.clearControls(),this.propertyControls=[]}createHeader(e){const t=new BABYLON.GUI.TextBlock;t.text=`Object: ${e.name}`,t.height="40px",t.color="#4a9eff",t.fontSize=18,t.fontWeight="bold",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.paddingLeft="5px",this.panel.addControl(t);const i=new BABYLON.GUI.InputText;i.width="280px",i.height="30px",i.color="white",i.background="#3a3a3a",i.text=e.name,i.fontSize=14,i.onTextChangedObservable.add(n=>{const s=n.text.trim();if(s&&s!==e.name){let a=s,l=1;for(;this.editor.scene.getMeshByName(a)||this.editor.scene.getLightByName(a);)a=`${s}_${l}`,l++;e.name=a,t.text=`Object: ${a}`,n.text=a,this.editor.sceneHierarchy&&this.editor.sceneHierarchy.refresh()}}),this.panel.addControl(i);const o=new BABYLON.GUI.Container;o.height="10px",this.panel.addControl(o)}createMaterialSection(e){if(!e.material)return;this.addSectionHeader("Material");const t=e.material;t.diffuseColor&&this.addColorControl("Diffuse",t.diffuseColor,i=>{t.diffuseColor=i}),t.specularColor&&this.addColorControl("Specular",t.specularColor,i=>{t.specularColor=i}),t.emissiveColor&&this.addColorControl("Emissive",t.emissiveColor,i=>{t.emissiveColor=i})}addColorControl(e,t,i){const o=new BABYLON.GUI.TextBlock;o.text=e+" Color:",o.height="25px",o.color="white",o.fontSize=12,o.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,o.paddingLeft="5px",this.panel.addControl(o);const n=new BABYLON.GUI.ColorPicker;n.value=t,n.height="180px",n.width="180px",n.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,n.onValueChangedObservable.add(a=>{t.r=a.r,t.g=a.g,t.b=a.b,i(t)}),this.panel.addControl(n);const s=new BABYLON.GUI.Container;s.height="10px",this.panel.addControl(s)}createLightSection(e){if(e.position){this.addSectionHeader("Transform Gizmos"),this.createLightGizmoButtons(e);const s=new BABYLON.GUI.Container;s.height="10px",this.panel.addControl(s)}this.addSectionHeader("Light Properties");const t=new BABYLON.GUI.StackPanel;t.height="40px",t.isVertical=!1;const i=new BABYLON.GUI.TextBlock;i.text="Intensity:",i.width="80px",i.color="white",i.fontSize=12,t.addControl(i);const o=new BABYLON.GUI.Slider;o.minimum=0,o.maximum=10,o.value=e.intensity,o.height="20px",o.width="150px",o.color="#4a9eff",o.background="#3a3a3a",o.onValueChangedObservable.add(s=>{e.intensity=s}),t.addControl(o);const n=new BABYLON.GUI.TextBlock;if(n.text=e.intensity.toFixed(2),n.width="50px",n.color="white",n.fontSize=12,t.addControl(n),o.onValueChangedObservable.add(s=>{n.text=s.toFixed(2)}),this.panel.addControl(t),e.diffuse&&this.addColorControl("Light",e.diffuse,s=>{e.diffuse=s}),e.position&&(this.addSectionHeader("Position"),this.addVector3Control("X",e.position.x,s=>{e.position.x=s}),this.addVector3Control("Y",e.position.y,s=>{e.position.y=s}),this.addVector3Control("Z",e.position.z,s=>{e.position.z=s})),e.direction&&(this.addSectionHeader("Direction"),this.addVector3Control("X",e.direction.x,s=>{e.direction.x=s,e.direction.normalize()}),this.addVector3Control("Y",e.direction.y,s=>{e.direction.y=s,e.direction.normalize()}),this.addVector3Control("Z",e.direction.z,s=>{e.direction.z=s,e.direction.normalize()})),e.range!==void 0){this.addSectionHeader("Range");const s=new BABYLON.GUI.StackPanel;s.height="40px",s.isVertical=!1;const a=new BABYLON.GUI.TextBlock;a.text="Range:",a.width="80px",a.color="white",a.fontSize=12,s.addControl(a);const l=new BABYLON.GUI.Slider;l.minimum=1,l.maximum=50,l.value=e.range,l.height="20px",l.width="150px",l.color="#4a9eff",l.background="#3a3a3a",l.onValueChangedObservable.add(p=>{e.range=p}),s.addControl(l);const d=new BABYLON.GUI.TextBlock;d.text=e.range.toFixed(1),d.width="50px",d.color="white",d.fontSize=12,s.addControl(d),l.onValueChangedObservable.add(p=>{d.text=p.toFixed(1)}),this.panel.addControl(s)}}createDeleteButton(){const e=new BABYLON.GUI.Container;e.height="20px",this.panel.addControl(e);const t=BABYLON.GUI.Button.CreateSimpleButton("deleteBtn","Delete Object");t.width="280px",t.height="35px",t.color="white",t.background="#cc0000",t.fontSize=14,t.cornerRadius=4,t.onPointerEnterObservable.add(()=>{t.background="#ff0000"}),t.onPointerOutObservable.add(()=>{t.background="#cc0000"}),t.onPointerClickObservable.add(()=>{this.editor.deleteSelected()}),this.panel.addControl(t)}show(){this.currentObject&&this.scrollViewer&&(this.scrollViewer.isVisible=!0,this.isVisible=!0)}hide(){this.scrollViewer&&(this.scrollViewer.isVisible=!1,this.isVisible=!1)}createTransformSection(e){this.addSectionHeader("Transform Gizmos"),this.createGizmoButtons(e);const t=new BABYLON.GUI.Container;t.height="10px",this.panel.addControl(t),this.addSectionHeader("Position"),this.addVector3Control("X",e.position.x,i=>{e.position.x=i}),this.addVector3Control("Y",e.position.y,i=>{e.position.y=i}),this.addVector3Control("Z",e.position.z,i=>{e.position.z=i}),this.addSectionHeader("Rotation"),this.addVector3Control("X",e.rotation.x*180/Math.PI,i=>{e.rotation.x=i*Math.PI/180}),this.addVector3Control("Y",e.rotation.y*180/Math.PI,i=>{e.rotation.y=i*Math.PI/180}),this.addVector3Control("Z",e.rotation.z*180/Math.PI,i=>{e.rotation.z=i*Math.PI/180}),this.addSectionHeader("Scale"),this.addVector3Control("X",e.scaling.x,i=>{e.scaling.x=i}),this.addVector3Control("Y",e.scaling.y,i=>{e.scaling.y=i}),this.addVector3Control("Z",e.scaling.z,i=>{e.scaling.z=i})}createLightGizmoButtons(e){const t=new BABYLON.GUI.StackPanel;t.height="40px",t.isVertical=!1,t.paddingLeft="5px",this.moveButton=BABYLON.GUI.Button.CreateSimpleButton("moveGizmo","Move"),this.moveButton.width="90px",this.moveButton.height="35px",this.moveButton.color="white",this.moveButton.background="#3a3a3a",this.moveButton.fontSize=13,this.moveButton.cornerRadius=4,this.moveButton.onPointerClickObservable.add(()=>{this.toggleLightGizmoMode("move",e)}),t.addControl(this.moveButton),this.panel.addControl(t),this.updateGizmoButtonStates()}createGizmoButtons(e){const t=new BABYLON.GUI.StackPanel;t.height="40px",t.isVertical=!1,t.paddingLeft="5px",this.moveButton=BABYLON.GUI.Button.CreateSimpleButton("moveGizmo","Move"),this.moveButton.width="90px",this.moveButton.height="35px",this.moveButton.color="white",this.moveButton.background="#3a3a3a",this.moveButton.fontSize=13,this.moveButton.cornerRadius=4,this.moveButton.paddingRight="5px",this.moveButton.onPointerClickObservable.add(()=>{this.toggleGizmoMode("move")}),t.addControl(this.moveButton),this.scaleButton=BABYLON.GUI.Button.CreateSimpleButton("scaleGizmo","Scale"),this.scaleButton.width="90px",this.scaleButton.height="35px",this.scaleButton.color="white",this.scaleButton.background="#3a3a3a",this.scaleButton.fontSize=13,this.scaleButton.cornerRadius=4,this.scaleButton.paddingLeft="5px",this.scaleButton.onPointerClickObservable.add(()=>{this.toggleGizmoMode("scale")}),t.addControl(this.scaleButton),this.panel.addControl(t);const i=new BABYLON.GUI.StackPanel;i.height="30px",i.isVertical=!1,i.paddingLeft="5px",i.paddingTop="5px";const o=new BABYLON.GUI.Checkbox;o.name="uniformScale",o.width="20px",o.height="20px",o.isChecked=this.uniformScaling,o.color="#4a9eff",o.background="#3a3a3a",o.onIsCheckedChangedObservable.add(s=>{this.uniformScaling=s,this.editor.updateScaleGizmoUniformMode(s)}),i.addControl(o);const n=new BABYLON.GUI.TextBlock;n.text=" Lock Aspect Ratio",n.width="150px",n.height="20px",n.color="white",n.fontSize=12,n.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,n.paddingLeft="5px",i.addControl(n),this.panel.addControl(i),this.uniformScaleCheckbox=i,this.updateGizmoButtonStates()}toggleLightGizmoMode(e,t){this.activeGizmoMode===e?(this.activeGizmoMode=null,this.editor.setLightGizmoMode(null,t)):(this.activeGizmoMode=e,this.editor.setLightGizmoMode(e,t)),this.updateGizmoButtonStates()}toggleGizmoMode(e){this.activeGizmoMode===e?(this.activeGizmoMode=null,this.editor.setGizmoMode(null)):(this.activeGizmoMode=e,this.editor.setGizmoMode(e)),this.updateGizmoButtonStates()}updateGizmoButtonStates(){this.moveButton&&(this.activeGizmoMode==="move"?this.moveButton.background="#4a9eff":this.moveButton.background="#3a3a3a"),this.scaleButton&&(this.activeGizmoMode==="scale"?this.scaleButton.background="#4a9eff":this.scaleButton.background="#3a3a3a"),this.uniformScaleCheckbox&&(this.uniformScaleCheckbox.isVisible=this.activeGizmoMode==="scale")}addSectionHeader(e){const t=new BABYLON.GUI.TextBlock;t.text=e,t.height="25px",t.color="white",t.fontSize=14,t.fontWeight="bold",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.paddingLeft="5px",this.panel.addControl(t)}addVector3Control(e,t,i){const o=new BABYLON.GUI.StackPanel;o.height="30px",o.isVertical=!1;const n=new BABYLON.GUI.TextBlock;n.text=e+":",n.width="30px",n.color="white",n.fontSize=12,n.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,o.addControl(n);const s=new BABYLON.GUI.InputText;s.width="240px",s.height="25px",s.color="white",s.background="#3a3a3a",s.text=t.toFixed(2),s.fontSize=12,s.onTextChangedObservable.add(a=>{const l=parseFloat(a.text);isNaN(l)||i(l)}),o.addControl(s),this.panel.addControl(o)}}class z{constructor(e,t){this.editor=e,this.guiTexture=t,this.panel=null,this.scrollViewer=null,this.objectButtons=new Map,this.isVisible=!0,this.initialize()}initialize(){this.scrollViewer=new BABYLON.GUI.ScrollViewer,this.scrollViewer.width="240px",this.scrollViewer.height="45%",this.scrollViewer.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,this.scrollViewer.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,this.scrollViewer.left="10px",this.scrollViewer.top="-50px",this.scrollViewer.background="#2a2a2a",this.scrollViewer.thickness=2,this.scrollViewer.thumbLength=.5,this.scrollViewer.barColor="#4a9eff",this.scrollViewer.barBackground="#1a1a1a",this.scrollViewer.isPointerBlocker=!0,this.guiTexture.addControl(this.scrollViewer),this.panel=new BABYLON.GUI.StackPanel,this.panel.width="200px",this.scrollViewer.addControl(this.panel),this.editor.selectionManager.addSelectionCallback(e=>{this.highlightSelected(e)}),this.refresh(),console.log("SceneHierarchy initialized with 45% height and scrolling")}refresh(){this.panel.clearControls(),this.objectButtons.clear();const e=new BABYLON.GUI.TextBlock;e.text="Scene Hierarchy",e.height="30px",e.width="190px",e.color="#4a9eff",e.fontSize=16,e.fontWeight="bold",e.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,e.textWrapping=!0,e.paddingLeft="5px",this.panel.addControl(e);const t=this.editor.scene.meshes.filter(o=>!o.name.startsWith("_")),i=this.editor.scene.lights;this.addSection("Meshes",t),this.addSection("Lights",i)}addSection(e,t){if(t.length===0)return;const i=new BABYLON.GUI.TextBlock;i.text=e,i.height="25px",i.color="white",i.fontSize=14,i.fontWeight="bold",i.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,i.paddingLeft="5px",this.panel.addControl(i),t.forEach(n=>{const s=this.createObjectButton(n);this.panel.addControl(s),this.objectButtons.set(n,s)});const o=new BABYLON.GUI.Container;o.height="5px",this.panel.addControl(o)}createObjectButton(e){const t=BABYLON.GUI.Button.CreateSimpleButton(`hierarchy_${e.name}_${Date.now()}`,e.name);return t.width="180px",t.height="25px",t.color="white",t.background="#333",t.fontSize=12,t.cornerRadius=2,t.paddingLeft="10px",t.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.onPointerEnterObservable.add(()=>{this.editor.selectionManager.selectedObject!==e&&(t.background="#444")}),t.onPointerOutObservable.add(()=>{this.editor.selectionManager.selectedObject!==e&&(t.background="#333")}),t.onPointerClickObservable.add(()=>{this.editor.selectionManager.selectObject(e)}),t}highlightSelected(e){this.objectButtons.forEach((t,i)=>{i===e?t.background="#4a9eff":t.background="#333"})}show(){this.scrollViewer&&(this.scrollViewer.isVisible=!0,this.isVisible=!0)}hide(){this.scrollViewer&&(this.scrollViewer.isVisible=!1,this.isVisible=!1)}}let g=null,h=null,u=null,b=Date.now(),c=null;window.addEventListener("DOMContentLoaded",()=>{Y()});function M(r){const e=BABYLON.MeshBuilder.CreateGround("floor",{width:20,height:20},r);e.position.y=0;const t=BABYLON.MeshBuilder.CreateGround("ceiling",{width:20,height:20},r);t.position.y=3,t.rotation.z=Math.PI;const i=BABYLON.MeshBuilder.CreateBox("wallNorth",{width:20,height:3,depth:.5},r);i.position=new BABYLON.Vector3(0,1.5,10);const o=BABYLON.MeshBuilder.CreateBox("wallSouth",{width:20,height:3,depth:.5},r);o.position=new BABYLON.Vector3(0,1.5,-10);const n=BABYLON.MeshBuilder.CreateBox("wallEast",{width:.5,height:3,depth:20},r);n.position=new BABYLON.Vector3(10,1.5,0);const s=BABYLON.MeshBuilder.CreateBox("wallWest",{width:.5,height:3,depth:20},r);return s.position=new BABYLON.Vector3(-10,1.5,0),console.log("Room environment geometry created"),{floor:e,ceiling:t,walls:[i,o,n,s]}}function A(r,e){const t=new BABYLON.StandardMaterial("floorMat",e);t.diffuseColor=new BABYLON.Color3(.1,.1,.1),t.specularColor=new BABYLON.Color3(.01,.01,.01),r.floor.material=t;const i=new BABYLON.StandardMaterial("ceilingMat",e);i.diffuseColor=new BABYLON.Color3(.05,.05,.05),i.specularColor=new BABYLON.Color3(.01,.01,.01),r.ceiling.material=i;const o=new BABYLON.StandardMaterial("wallMat",e);o.diffuseColor=new BABYLON.Color3(.165,.165,.165),o.specularColor=new BABYLON.Color3(.01,.01,.01),r.walls.forEach(n=>{n.material=o}),console.log("Spooky materials applied to room meshes")}function x(r){const e=new BABYLON.HemisphericLight("hemisphericLight",new BABYLON.Vector3(0,1,0),r);e.intensity=.3,e.diffuse=new BABYLON.Color3(.5,.5,.6),e.specular=new BABYLON.Color3(.1,.1,.15),e.groundColor=new BABYLON.Color3(.1,.1,.1);const t=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(0,2,0),r);return t.intensity=.5,t.diffuse=new BABYLON.Color3(1,.7,.4),t.specular=new BABYLON.Color3(.5,.35,.2),t.range=15,console.log("Atmospheric lighting system initialized"),{hemisphericLight:e,pointLight:t}}function N(){const r={webglSupported:!1,webgl2Supported:!1,browserName:"Unknown",browserVersion:"Unknown",compatible:!1,warnings:[]},e=navigator.userAgent;e.indexOf("Chrome")>-1&&e.indexOf("Edg")===-1?r.browserName="Chrome":e.indexOf("Firefox")>-1?r.browserName="Firefox":e.indexOf("Edg")>-1?r.browserName="Edge":e.indexOf("Safari")>-1&&(r.browserName="Safari");const t=document.createElement("canvas"),i=t.getContext("webgl")||t.getContext("experimental-webgl"),o=t.getContext("webgl2");return i&&(r.webglSupported=!0),o&&(r.webgl2Supported=!0),r.webgl2Supported?(r.compatible=!0,console.log("✓ WebGL 2.0 supported")):r.webglSupported?(r.compatible=!0,r.warnings.push("WebGL 2.0 not supported, falling back to WebGL 1.0"),console.warn("⚠ WebGL 2.0 not supported, using WebGL 1.0 fallback")):(r.compatible=!1,console.error("✗ WebGL not supported")),["Chrome","Firefox","Edge"].includes(r.browserName)||r.warnings.push(`Browser ${r.browserName} may not be fully supported. Recommended: Chrome, Firefox, or Edge`),console.log(`Browser: ${r.browserName}, WebGL: ${r.webglSupported}, WebGL2: ${r.webgl2Supported}`),r}function G(){const r=document.createElement("div");return r.id="fps-counter",r.style.cssText=`
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: #00ff00;
    padding: 8px 12px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    z-index: 1000;
    min-width: 80px;
  `,r.textContent="FPS: --",document.body.appendChild(r),r}function S(){if(u&&g){const r=g.getFps().toFixed(0);u.textContent=`FPS: ${r}`,r>=50?u.style.color="#00ff00":r>=30?u.style.color="#ffff00":u.style.color="#ff0000"}}function v(){const r=(Date.now()-b)/1e3;return console.log(`Game loaded in ${r.toFixed(2)} seconds`),r>5?console.warn(`⚠ Load time (${r.toFixed(2)}s) exceeds target of 5 seconds`):console.log("✓ Load time within target (< 5 seconds)"),r}function Y(){try{const r=N();if(!r.compatible){m("WebGL is not supported in your browser. Please use a modern browser like Chrome, Firefox, or Edge.");return}r.warnings.length>0&&r.warnings.forEach(o=>{console.warn(o)});const e=document.getElementById("renderCanvas");if(!e){console.error("Canvas element not found"),m("Failed to initialize: Canvas element not found");return}try{g=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!r.webgl2Supported})}catch(o){console.error("Failed to create Babylon.js engine:",o),m("WebGL not supported or failed to initialize. Please use a modern browser.");return}h=new BABYLON.Scene(g),h.clearColor=new BABYLON.Color3(.01,.01,.02);const t=M(h);A(t,h),x(h);const i=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");c=new L(h,e),c.initialize(i),c.objectPalette=new O(c,i),c.propertyPanel=new y(c,i),c.sceneHierarchy=new z(c,i),c.enterEditorMode(),window.addEventListener("resize",()=>{g.resize()}),console.log("Spooky Game - Engine and scene initialized successfully"),u=G(),v(),g.runRenderLoop(()=>{try{h.render(),S()}catch(o){console.error("Render error:",o)}})}catch(r){console.error("Unexpected error during initialization:",r),m("An unexpected error occurred during initialization")}}function m(r){let e=document.getElementById("error-message");e||(e=document.createElement("div"),e.id="error-message",e.style.cssText="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #ff0000; color: #ffffff; padding: 20px; border-radius: 5px; font-family: Arial, sans-serif; z-index: 1000;",document.body.appendChild(e)),e.textContent=r}
