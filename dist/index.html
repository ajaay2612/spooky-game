<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spooky Game</title>
  <style>
    /* Custom Fonts */
    @font-face {
      font-family: 'Roboto Mono';
      src: url('/assets/RobotoMono-Regular-CBo0Sm2n.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
    }
    @font-face {
      font-family: 'Roboto Mono';
      src: url('/assets/RobotoMono-Bold-CheSjNdw.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
    }
    @font-face {
      font-family: 'Print Char';
      src: url('/assets/print-char-21-BXL_GNjH.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100vh;
    }
    #renderCanvas {
      width: 100%;
      height: 100vh;
      touch-action: none;
      display: block;
    }
    
    /* Part 1 fullscreen iframe overlay */
    #part1Iframe {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      z-index: 9999;
      background: #000;
    }
  </style>
  <script type="module" crossorigin src="/assets/index-BYMcExko.js"></script>
</head>
<body>
  <!-- Part 1 iframe overlay (removed when part 1 completes) -->
  <iframe id="part1Iframe" src="part-1/index.html"></iframe>
  
  <canvas id="renderCanvas"></canvas>
  
  <!-- Listen for part 1 and part 2 completion -->
  <script>
    window.addEventListener('message', (event) => {
      if (event.data.type === 'part1Complete') {
        console.log('‚úÖ Part 1 completed - removing iframe and animating camera');
        const iframe = document.getElementById('part1Iframe');
        if (iframe) {
          iframe.remove();
          console.log('‚úì Iframe removed');
          
          // Trigger camera animation from monitor
          if (window.animateCameraFromMonitor) {
            window.animateCameraFromMonitor();
          } else {
            console.warn('‚ö†Ô∏è Camera animation function not ready yet');
          }
        }
      }
      
      // part2Complete is now handled by Monitor2Controller.js
      // Removed duplicate handler to prevent showing ending screen twice
    });
    
    // Console function to skip part 1 for testing
    window.skipPart1 = function() {
      console.log('‚è© Skipping Part 1 - going straight to Babylon.js');
      const iframe = document.getElementById('part1Iframe');
      if (iframe) {
        iframe.remove();
        console.log('‚úÖ Part 1 iframe removed - Babylon.js game visible');
        
        // Move camera to normal position immediately (no animation)
        if (window.scene && window.scene.activeCamera && window.cameraOriginalPosition) {
          window.scene.activeCamera.position.copyFrom(window.cameraOriginalPosition);
          if (window.scene.activeCamera.rotation && window.cameraOriginalRotation) {
            window.scene.activeCamera.rotation.copyFrom(window.cameraOriginalRotation);
          }
          
          // Restore lights immediately
          if (window.originalLightIntensities) {
            window.originalLightIntensities.forEach(data => {
              data.light.intensity = data.intensity;
            });
          }
          
          console.log('‚úì Camera moved to starting position - lights restored');
        }
        
        // Check if canvas is visible
        const canvas = document.getElementById('renderCanvas');
        if (canvas) {
          console.log('‚úì Canvas is visible');
          console.log('  Canvas size:', canvas.width, 'x', canvas.height);
        }
        
        // Check if scene exists
        if (window.scene) {
          console.log('‚úì Babylon.js scene exists');
          console.log('  Active camera:', window.scene.activeCamera ? 'Yes' : 'No');
        } else {
          console.log('‚ö†Ô∏è Babylon.js scene not initialized yet - wait a moment and it should appear');
        }
      } else {
        console.log('‚ö†Ô∏è Part 1 iframe already removed');
      }
    };
    
    console.log('üí° Tip: Call skipPart1() to skip Part 1 and test the transition');
    
    // Console function to trigger Part 3 ending screen for testing
    window.showEndingScreen = function() {
      console.log('üéâ Manually triggering ending screen...');
      
      // Stop background music
      if (window.backgroundMusic) {
        window.backgroundMusic.pause();
        console.log('üéµ Background music stopped');
      }
      
      // Create and show Part 3 (ending screen) iframe
      const part3Iframe = document.createElement('iframe');
      part3Iframe.id = 'part3Iframe';
      part3Iframe.src = 'part-3/index.html';
      part3Iframe.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        z-index: 9999;
        background: #000;
      `;
      document.body.appendChild(part3Iframe);
      console.log('‚úì Part 3 ending screen displayed');
    };
    
    console.log('üí° Tip: Call showEndingScreen() to test the ending screen');
  </script>
  
  <!-- Babylon.js CDN -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  <!-- html2canvas for HTML rendering -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- Main game script -->
</body>
</html>
