{
  "enabled": true,
  "name": "Pre-Push Comprehensive Validation",
  "description": "Comprehensive pre-push validation including documentation, code quality, security, testing, build verification, and performance checks",
  "version": "1",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Run comprehensive pre-push validation across all critical areas:\n\n## 1. AUTO-DOCUMENTATION UPDATE\nAnalyze modified source files (*.js, *.ts, *.jsx, *.tsx, *.glb, *.gltf, shaders) and update:\n- STEERING.md for architectural decisions\n- README.md for user-facing features and API changes\n- ARCHITECTURE.md for system design patterns\n- CHANGELOG.md with versioned change history\n- PERFORMANCE.md with bundle size and metrics\n- GAME_DESIGN.md for gameplay mechanics\n- Generate/update inline JSDoc comments\n\n## 2. CODE QUALITY CHECKS\n- Run ESLint for code style issues and potential bugs\n- Run Prettier to ensure consistent formatting\n- Run TypeScript compiler in check mode (tsc --noEmit) if applicable\n- Report errors/warnings and flag critical issues\n\n## 3. DEPENDENCY AUDIT\n- Scan package.json and lock files for security vulnerabilities\n- Check against CVE and npm audit databases\n- Compare versions against latest available\n- Flag outdated packages and breaking changes\n\n## 4. GAME-SPECIFIC VALIDATION (Babylon.js)\n- Check for excessive draw calls impacting frame rate\n- Count materials per scene (warn if too many)\n- Detect duplicate meshes that should use instancing\n- Estimate VRAM usage from textures/geometry\n- Scan for unreleased resources (missing dispose() calls)\n- Validate physics impostor configurations\n- Check collision layer settings\n\n## 5. ENVIRONMENT VALIDATION (Secrets Scanning)\n- Scan for hardcoded API keys, tokens, passwords\n- Check for exposed credentials in code/config files\n- Validate .env structure matches .env.example\n- Ensure .env is in .gitignore\n- Verify no credentials in version control\n\n## 6. AUTOMATED TESTING\n- Run all unit tests\n- Execute integration tests\n- Run game-specific tests (physics, collision)\n- Check test coverage meets threshold (80%)\n- Fail if coverage drops below minimum\n\n## 7. BUILD VERIFICATION\n- Attempt full production build (npm run build)\n- Check bundle size doesn't exceed limits (5MB)\n- Verify no console errors/warnings in production build\n- Test WebGL/WebGPU compatibility\n- Validate all assets included in build output\n\n## 8. PERFORMANCE BENCHMARKING\n- Run FPS tests (targeting 60fps)\n- Measure frame time consistency (detect stuttering)\n- Identify FPS drops during gameplay\n- Measure scene load times\n- Track asset loading performance\n- Time shader compilation\n- Monitor memory usage and detect leaks\n- Watch for garbage collection spikes\n\n## 9. BREAKING CHANGE DETECTION\n- Identify modified code paths\n- Run targeted smoke tests on changed systems:\n  * Core gameplay loops\n  * Player movement\n  * Collision detection\n  * UI interactions\n- Attempt auto-fix for common issues (imports, config)\n- If auto-fix fails, provide detailed error report\n- Offer rollback option for critical failures\n\n## FINAL REPORT\nProvide comprehensive summary with:\n- ‚úÖ Passed checks\n- ‚ö†Ô∏è Warnings that need attention\n- ‚ùå Critical issues blocking push\n- üìä Performance metrics\n- üìù Documentation updates made\n- üîí Security findings\n\n**BLOCK PUSH if critical issues found. Otherwise, approve with summary.**"
  }
}