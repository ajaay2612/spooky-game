{
  "enabled": true,
  "name": "Pre-Push Comprehensive Validation",
  "description": "Comprehensive pre-push validation including documentation, code quality, security, testing, build verification, and performance checks",
  "version": "1",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Run comprehensive pre-push validation across all critical areas:\n\n**IMPORTANT**: DO NOT use git log or git commands. Instead, analyze all project files, documentation (README.md, CHANGELOG.md, ARCHITECTURE.md, PERFORMANCE.md, etc.), and source code to understand the current state.\n\n## 1. AUTO-DOCUMENTATION UPDATE\n**CRITICAL**: Actually UPDATE the documentation files, don't just check them!\n\n### Step 1: Analyze Changes\n- Read all source files in src/ directory and main.js\n- Identify new classes, methods, features added\n- Check package.json for dependency changes\n- Review recent code changes\n\n### Step 2: Update README.md\n- Features section: Add any new features (editor tools, object types, controls)\n- Controls section: Add new keyboard shortcuts or mouse controls\n- Architecture section: Update class list if new classes added\n- Roadmap section: Move completed items from planned to completed\n- Project Structure: Update file tree if new directories/files added\n- Use strReplace to update specific sections\n\n### Step 3: Update GAME_DESIGN.md\n- Mechanics section: Move implemented features from Planned to Implemented\n- Object Types section: Add new primitives, lights, or importable types\n- Controls section: Add new keyboard shortcuts with descriptions\n- UI section: Update if new panels or controls added\n- Use strReplace to update specific sections\n\n### Step 4: Update CHANGELOG.md\n- Current version section: Add detailed list of changes in Added/Changed/Fixed/Removed\n- Documentation subsection: List all documentation files updated with brief description\n- Include performance improvements with metrics\n- Use strReplace to update the current version entry\n\n### Step 5: Update ARCHITECTURE.md (if architecture changed)\n- Add new classes to Core Components section\n- Update data flow diagrams if architecture changed\n- Document new design patterns used\n\n### Step 6: Update PERFORMANCE.md (if performance changed)\n- Add new performance metrics from build\n- Update bundle size analysis\n- Add before/after comparisons for optimizations\n\n### Step 7: Update STEERING.md (if architectural decisions made)\n- Document new architectural decisions\n- Add new coding patterns or standards\n- Update best practices based on learnings\n\n**OUTPUT**: List all documentation files updated with specific changes made\n\n## 2. CODE QUALITY CHECKS\n- Run getDiagnostics on all source files\n- Check for syntax errors, type issues, linting problems\n- Report errors/warnings and flag critical issues\n- Verify no console.log in production code (or document if intentional)\n\n## 3. DEPENDENCY AUDIT\n- Run npm audit --json\n- Scan for security vulnerabilities\n- Flag critical and high severity issues\n- Document moderate/low issues with risk assessment\n- Check if fixes available\n\n## 4. GAME-SPECIFIC VALIDATION (Babylon.js)\n- Search for dispose() patterns - verify proper cleanup\n- Search for material creation - check for pooling\n- Search for createInstance - verify instancing used\n- Check for excessive object creation in loops\n- Verify event listeners are cleaned up\n\n## 5. ENVIRONMENT VALIDATION (Secrets Scanning)\n- Search for hardcoded API keys, tokens, passwords using regex\n- Check .gitignore includes .env\n- Verify no .env files in repository\n- Scan for credential patterns in all files\n\n## 6. AUTOMATED TESTING\n- Check if test files exist\n- If tests exist, run them\n- If no tests, note as future enhancement\n- Do not block push for missing tests\n\n## 7. BUILD VERIFICATION\n- Run npm run build\n- Check build succeeds without errors\n- Measure bundle size\n- Compare to previous build if available\n- Verify dist/ directory created\n\n## 8. PERFORMANCE BENCHMARKING\n- Review PERFORMANCE.md for current metrics\n- Check if performance targets met (60fps, <20 draw calls)\n- Note any performance regressions\n- Validate memory leak fixes\n\n## 9. BREAKING CHANGE DETECTION\n- Compare current code to documented API\n- Check if public methods removed or signatures changed\n- Verify backward compatibility\n- Document any breaking changes in CHANGELOG\n\n## FINAL REPORT\nProvide comprehensive summary with:\n- âœ… Passed checks\n- âš ï¸ Warnings that need attention\n- âŒ Critical issues blocking push\n- ðŸ“Š Performance metrics\n- ðŸ“ Documentation updates made (list specific files and changes)\n- ðŸ”’ Security findings\n\n**BLOCK PUSH if critical issues found. Otherwise, approve with summary.**"
  }
}
